#!/usr/bin/env python3
import os, datetime, random, textwrap, requests

DOMAINS = [
    "nftgameai.com", "botgame.io", "metaversebot.io", "hubgaming.io",
    "botdefi.io", "botweb3ai.com", "bottradingai.com",
    "botplay.io", "botblockchain.io", "nftgamepro.com",
    "botesports.com", "esportsai.io", "aiesports.io", "pronftgame.com"
]

IMAGES = [
    "https://images.pexels.com/photos/8370753/pexels-photo-8370753.jpeg",
    "https://images.pexels.com/photos/8390113/pexels-photo-8390113.jpeg",
    "https://images.pexels.com/photos/5961226/pexels-photo-5961226.jpeg"
]

TOPICS = [
    "AI in NFT Game Economy Design",
    "Metaverse Gaming with Generative AI",
    "Blockchain-driven Rewards in NFT Games",
    "How AI Personalizes Play-to-Earn Experiences",
    "Building Sustainable NFT Game Worlds"
]

def pick_backlinks(domain):
    others = [d for d in DOMAINS if d != domain]
    random.shuffle(others)
    return "\n".join(["- [%s](https://%s)" % (d, d) for d in others[:5]])

def create_post():
    domain = os.environ.get("SITE_DOMAIN", "nftgameai.com")
    title = random.choice(TOPICS)
    date = datetime.date.today().isoformat()
    desc = title + " — fresh AI insights."
    image = random.choice(IMAGES)
    backlinks = pick_backlinks(domain)

    md = textwrap.dedent(f"""\
    ---
    layout: post
    title: "{title}"
    date: {date}
    author: "Auto Bot"
    description: "{desc}"
    image: "{image}"
    ---

    This post was auto-generated by NFTGameAI engine.

    {% raw %}{{% include ad.html %}}{% endraw %}

    ## Key Highlights
    - AI innovation
    - NFT integration
    - Future metaverse design

    ### Friendly Network
    {backlinks}
    """)

    os.makedirs("_posts", exist_ok=True)
    slug = title.lower().replace(" ", "-").replace("/", "-")
    path = os.path.join("_posts", f"{date}-{slug}.md")
    with open(path, "w", encoding="utf-8") as f:
        f.write(md)
    print("✅ New post created:", path)

    # Ping Google
    try:
        sitemap = f"https://{domain}/sitemap.xml"
        ping_url = f"https://www.google.com/ping?sitemap={sitemap}"
        requests.get(ping_url, timeout=10)
        print("✅ Pinged Google:", ping_url)
    except Exception as e:
        print("⚠️ Ping failed:", e)

if __name__ == "__main__":
    create_post()
